<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Access&Credential Info Lookup</title>
<style>
    body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
    .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
    h1 { text-align: center; color: #333; }
    label { display: block; margin-bottom: 8px; font-weight: bold; }
    input[type="email"] { width: calc(100% - 22px); padding: 10px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; }
    button { /* Main search button */
        background-color: #007bff; color: white; padding: 10px 15px; border: none;
        border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%;
    }
    button:hover { background-color: #0056b3; }
    #results { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 4px; }

    /* Styles for each result row (paragraph) */
    #results p {
        margin: 8px 0;
        display: flex;                /* Use flexbox for layout */
        justify-content: space-between; /* Pushes info to left, button to right */
        align-items: center;          /* Vertically align items in the center */
        gap: 10px;                    /* Adds a small gap between the info and the button */
        border-bottom: 1px solid #ddd; /* Optional: adds a line between items */
        padding-bottom: 8px;          /* Optional: padding for the line */
    }
    #results p:last-child {
        border-bottom: none; /* Optional: remove border from last item */
    }

    /* Styles for the text part of the result (Key: Value) */
    #results p span {
        flex-grow: 1; /* Allows the text span to take up available space */
        word-break: break-all; /* Helps prevent long text from breaking layout */
    }
    #results p strong { margin-right: 5px; }
    #results p span em { /* Style for (empty) placeholder */
        color: #777;
        font-style: italic;
    }
    /* Styles for the Copy Button */
    .copy-btn {
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;    /* Adjust font size if needed */
        box-sizing: border-box; /* Ensures padding & border are INCLUDED in width/height */
        min-width: 70px;      /* Give it a bit more minimum width to ensure "Copy" fits comfortably with padding */
                          /* Adjust this value based on how it looks */
        width: auto;          /* Let the width be determined by content + padding, unless min-width is larger */

        /* --- Flexbox for Centering Content --- */
        display: inline-flex; /* Treat the button as an inline-level flex container */
        align-items: center;    /* Vertical centering of content */
        justify-content: center;/* Horizontal centering of content */

        /* --- Text Properties --- */
        text-align: center;     /* Fallback / belt-and-suspenders for text */
        line-height: normal;    /* Reset line-height to prevent interference */
    }
    .copy-btn:hover { background-color: #5a6268; }
    .copy-btn.copied { background-color: #28a745; } /* Green when copied */
    .data-separator {
            margin-top: 12px;
            margin-bottom: 12px;
            border: 0;
            border-top: 1px solid #ccc; /* A simple horizontal line */
        }
    .loading { text-align: center; font-style: italic; }
    .error { color: red; font-weight: bold; }
</style>
</head>
<body>
    <div class="container">
        <h1>Find Personal Information</h1>
        <label for="email">Enter Email Address:</label>
        <input type="email" id="emailInput" placeholder="e.g., user@example.com">
        <button onclick="fetchInfo()">Search</button>
        <div id="results">
            <p>Enter an email and click search to see details.</p>
        </div>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyeVbytEhwe8LMf-jtTWvWmbi3sQNhWS4CMdkZxeifApno33XHULkIL7WBi25LuIGH6/exec'; // !!! PASTE YOUR URL HERE !!!
        const SEPARATOR_HEADER_KEY = "---"; // !!! IMPORTANT: Change this if your separator column header is different !!!

        async function fetchInfo() {
            const email = document.getElementById('emailInput').value.trim();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p class="loading">Loading...</p>';

            if (!WEB_APP_URL || WEB_APP_URL.includes('YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') || WEB_APP_URL.includes('YOUR_URL_HERE')) {
                resultsDiv.innerHTML = '<p class="error">ERROR: WEB_APP_URL is not configured correctly in the script.</p>';
                console.error("WEB_APP_URL is not configured:", WEB_APP_URL);
                return;
            }
            if (!email) {
                resultsDiv.innerHTML = '<p class="error">Please enter an email address.</p>';
                return;
            }

            const requestUrl = `${WEB_APP_URL}?email=${encodeURIComponent(email)}`;
            console.log("Attempting to fetch:", requestUrl);

            try {
    const response = await fetch(requestUrl);
    // if (!response.ok) { /* ... your existing error handling for response.ok ... */ } // You can keep this

    const responseText = await response.text(); // Get it as text first
    console.log("FRONTEND: Raw response text:", responseText);

    const data = JSON.parse(responseText); // Parse it
    console.log("FRONTEND: Parsed data object:", JSON.stringify(data, null, 2));


    if (data.success && data.data) {
        console.log("FRONTEND: data.data object:", JSON.stringify(data.data, null, 2));
        console.log("FRONTEND: Keys of data.data:", Object.keys(data.data));

        let htmlOutput = '<h3>Information Found:</h3>';
        const headersInOrder = Object.keys(data.data);

        for (const key of headersInOrder) { // key will be "Email", then "Name", etc.
            console.log(`FRONTEND: Processing key: "${key}"`); // Log each key
            if (Object.hasOwnProperty.call(data.data, key)) {
                const value = data.data[key] || "";
                console.log(`FRONTEND: Value for "${key}": "${value}"`); // Log each value
                const escapedKey = escapeHtml(key);
                const displayValue = value ? escapeHtml(value) : "<em>--------------</em>";

                // ... rest of your HTML generation ...
                if (key === SEPARATOR_HEADER_KEY) {
                    htmlOutput += `<hr class="data-separator">`;
                } else {
                    htmlOutput += `<p>`;
                    htmlOutput += `<span><strong>${escapedKey}:</strong> ${displayValue}</span>`;
                    if (value) {
                        htmlOutput += `<button class="copy-btn" onclick="copyToClipboard(this, '${escapeJsString(value)}')">Copy</button>`;
                    }
                    htmlOutput += `</p>`;
                }
            }
        }
        resultsDiv.innerHTML = htmlOutput;
    } else if (data.message) { /* ... */ }
    // ... rest of your conditions ...
} catch (error) {
    console.error("FRONTEND: Fetch or processing error:", error); // Log any catch block errors
        }
    }
        // ... (escapeHtml, escapeJsString, copyToClipboard, updateCopyButton functions as before) ...
        // ... (event listener for Enter key as before) ...

        // Make sure all helper functions are here:
        function escapeHtml(unsafe) { /* ... */ }
        function escapeJsString(unsafe) { /* ... */ }
        async function copyToClipboard(buttonElement, textToCopy) { /* ... */ }
        function updateCopyButton(buttonElement, success, message = 'Copied!') { /* ... */ }

        document.getElementById('emailInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                fetchInfo();
            }
        });
    </script>
</body>
</html>