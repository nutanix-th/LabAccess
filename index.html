<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Access&Credential Info Lookup</title>
<style>
    body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
    .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
    h1 { text-align: center; color: #333; }
    label { display: block; margin-bottom: 8px; font-weight: bold; }
    input[type="email"] { width: calc(100% - 22px); padding: 10px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; }
    button { /* Main search button */
        background-color: #007bff; color: white; padding: 10px 15px; border: none;
        border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%;
    }
    button:hover { background-color: #0056b3; }
    #results { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 4px; }

    /* Styles for each result row (paragraph) */
    #results p {
        margin: 8px 0;
        display: flex;                /* Use flexbox for layout */
        justify-content: space-between; /* Pushes info to left, button to right */
        align-items: center;          /* Vertically align items in the center */
        gap: 10px;                    /* Adds a small gap between the info and the button */
        border-bottom: 1px solid #ddd; /* Optional: adds a line between items */
        padding-bottom: 8px;          /* Optional: padding for the line */
    }
    #results p:last-child {
        border-bottom: none; /* Optional: remove border from last item */
    }

    /* Styles for the text part of the result (Key: Value) */
    #results p span {
        flex-grow: 1; /* Allows the text span to take up available space */
        word-break: break-all; /* Helps prevent long text from breaking layout */
    }
    #results p strong { margin-right: 5px; }


    /* Styles for the Copy Button */
    .copy-btn {
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;    /* Adjust font size if needed */
        padding: 6px 20px;  /* Adjust padding to change button size (height and width) */
        /* min-width: 60px; */ /* Optional: Set a minimum width if you want all buttons to be at least this wide */
         /*width: 40px;*/     /* Optional: Set a fixed width */
        /* height: 30px; */   /* Optional: Set a fixed height (careful with text overflow) */
        margin-left: auto;  /* This can also help push it to the right if justify-content isn't enough, but space-between is better */
        flex-shrink: 0;     /* Prevents the button from shrinking if the text is too long */
        text-align: center;
    }
    .copy-btn:hover { background-color: #5a6268; }
    .copy-btn.copied { background-color: #28a745; } /* Green when copied */

    .loading { text-align: center; font-style: italic; }
    .error { color: red; font-weight: bold; }
</style>
</head>
<body>
    <div class="container">
        <h1>Find Personal Information</h1>
        <label for="email">Enter Email Address:</label>
        <input type="email" id="emailInput" placeholder="e.g., user@example.com">
        <button onclick="fetchInfo()">Search</button>
        <div id="results">
            <p>Enter an email and click search to see details.</p>
        </div>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyeVbytEhwe8LMf-jtTWvWmbi3sQNhWS4CMdkZxeifApno33XHULkIL7WBi25LuIGH6/exec'; // !!! PASTE YOUR URL HERE !!!

        async function fetchInfo() {
            const email = document.getElementById('emailInput').value.trim();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p class="loading">Loading...</p>';

            if (!WEB_APP_URL || WEB_APP_URL.includes('YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') || WEB_APP_URL.includes('YOUR_URL_HERE')) {
                resultsDiv.innerHTML = '<p class="error">ERROR: WEB_APP_URL is not configured correctly in the script.</p>';
                console.error("WEB_APP_URL is not configured:", WEB_APP_URL);
                return;
            }

            if (!email) {
                resultsDiv.innerHTML = '<p class="error">Please enter an email address.</p>';
                return;
            }

            const requestUrl = `${WEB_APP_URL}?email=${encodeURIComponent(email)}`;
            console.log("Attempting to fetch:", requestUrl);

            try {
                const response = await fetch(requestUrl);
                if (!response.ok) {
                    let errorMsg = `HTTP error! Status: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        if (errorData && errorData.error) errorMsg = `Error: ${errorData.error}`;
                        else if (errorData && errorData.message) errorMsg = `Message: ${errorData.message}`;
                    } catch (e) { /* Could not parse JSON error */ }
                    throw new Error(errorMsg);
                }

                const data = await response.json();

                if (data.success && data.data) {
                    let htmlOutput = '<h3>Information Found:</h3>';
                    for (const key in data.data) {
                        if (Object.hasOwnProperty.call(data.data, key) && data.data[key]) { // Only show if value exists
                            const value = data.data[key];
                            // Create a unique ID for the button if needed, or just pass the value directly
                            htmlOutput += `<p>
                                            <span><strong>${escapeHtml(key)}:</strong> ${escapeHtml(value)}</span>
                                            <button class="copy-btn" onclick="copyToClipboard(this, '${escapeJsString(value)}')">Copy</button>
                                         </p>`;
                        }
                    }
                    resultsDiv.innerHTML = htmlOutput;
                } else if (data.message) {
                    resultsDiv.innerHTML = `<p>${escapeHtml(data.message)}</p>`;
                } else if (data.error) {
                    resultsDiv.innerHTML = `<p class="error">Error: ${escapeHtml(data.error)}</p>`;
                } else {
                    resultsDiv.innerHTML = '<p class="error">No information found or an unexpected response.</p>';
                }
            } catch (error) {
                console.error('Fetch error:', error);
                resultsDiv.innerHTML = `<p class="error">Failed to fetch information. ${error.message}. Check console for details.</p>`;
            }
        }

        function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') return '';
            return unsafe
                 .replace(/&/g, "&")
                 .replace(/</g, "<")
                 .replace(/>/g, ">")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "'");
        }

        // New function to escape strings for use in JavaScript function calls within HTML attributes
        function escapeJsString(unsafe) {
            if (typeof unsafe !== 'string') return '';
            return unsafe
                .replace(/\\/g, '\\\\')  // Backslash
                .replace(/'/g, '\\\'')   // Single quote
                .replace(/"/g, '\\"')    // Double quote
                .replace(/\n/g, '\\n')   // Newline
                .replace(/\r/g, '\\r')   // Carriage return
                .replace(/\t/g, '\\t')   // Tab
                .replace(/\u2028/g, '\\u2028') // Line separator
                .replace(/\u2029/g, '\\u2029'); // Paragraph separator
        }


        async function copyToClipboard(buttonElement, textToCopy) {
            if (!navigator.clipboard) {
                // Fallback for older browsers (less common now)
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = textToCopy;
                    textArea.style.position = "fixed"; // Prevent scrolling to bottom of page in MS Edge.
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    console.log('Fallback: Text copied to clipboard');
                    if(buttonElement) updateCopyButton(buttonElement, true);
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                    if(buttonElement) updateCopyButton(buttonElement, false, 'Error');
                }
                return;
            }

            try {
                await navigator.clipboard.writeText(textToCopy);
                console.log('Text copied to clipboard');
                if(buttonElement) updateCopyButton(buttonElement, true);
            } catch (err) {
                console.error('Failed to copy text: ', err);
                if(buttonElement) updateCopyButton(buttonElement, false, 'Error');
            }
        }

        function updateCopyButton(buttonElement, success, message = 'Copied!') {
            const originalText = buttonElement.textContent;
            if (success) {
                buttonElement.textContent = message;
                buttonElement.classList.add('copied');
                buttonElement.disabled = true;
            } else {
                buttonElement.textContent = message; // e.g., 'Error'
                // You might want to add an error class for styling
            }

            setTimeout(() => {
                buttonElement.textContent = originalText; // Or 'Copy'
                buttonElement.classList.remove('copied');
                buttonElement.disabled = false;
            }, 2000); // Reset after 2 seconds
        }


        // Optional: Allow pressing Enter in the input field to trigger search
        document.getElementById('emailInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                fetchInfo();
            }
        });
    </script>
</body>
</html>